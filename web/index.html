<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pump Control System</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="material-symbols-rounded">water_drop</span>
                <span>PUMP CONTROL</span>
            </div>
            <button class="toggle-btn" onclick="toggleSidebar()">
                <span class="material-symbols-rounded">menu</span>
            </button>
        </div>
        <ul class="nav-list">
            <li class="nav-item active" onclick="showPage('dashboard')">
                <span class="material-symbols-rounded nav-icon">dashboard</span>
                <span class="nav-label">Dashboard</span>
            </li>
            <li class="nav-item" onclick="showPage('history')">
                <span class="material-symbols-rounded nav-icon">history</span>
                <span class="nav-label">History</span>
            </li>
            <li class="nav-item" onclick="showPage('settings')">
                <span class="material-symbols-rounded nav-icon">settings</span>
                <span class="nav-label">Settings</span>
            </li>
        </ul>
    </aside>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn" onclick="toggleMobileMenu()">
        <span class="material-symbols-rounded">menu</span>
    </button>

    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="closeMobileMenu()"></div>

    <!-- Main Content -->
    <div class="main">
        <!-- Dashboard Page -->
        <div id="page-dashboard">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="material-symbols-rounded">monitoring</span>
                    System Dashboard
                </h1>
                <div class="last-update">
                    <span class="material-symbols-rounded" style="font-size: 16px;">schedule</span>
                    Last updated: <span id="lastUpdate">--:--:--</span>
                </div>
            </div>

            <!-- Gateway Status -->
            <div class="gateway-card">
                <h3>
                    <span class="material-symbols-rounded">router</span>
                    Gateway Status
                </h3>
                <div class="status-indicator">
                    <span class="status-dot offline" id="gatewayDot"></span>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                            <span class="material-symbols-rounded" style="font-size: 18px;">memory</span>
                            <strong>Device:</strong> <span id="deviceId">--</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                            <span class="material-symbols-rounded" style="font-size: 18px;">update</span>
                            <strong>Firmware:</strong> <span id="firmware">--</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="material-symbols-rounded" style="font-size: 18px;">access_time</span>
                            <strong>Last Seen:</strong> <span id="lastSeen">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="gateway-card">
                <h3>
                    <span class="material-symbols-rounded">info</span>
                    System Status
                </h3>
                <div class="info-row">
                    <span class="info-label">
                        <span class="material-symbols-rounded">settings_ethernet</span>
                        Inverter Status:
                    </span>
                    <span class="info-value" id="busyStatus">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">
                        <span class="material-symbols-rounded">notification_important</span>
                        System Alarm:
                    </span>
                    <span class="info-value" id="alarmStatus">--</span>
                </div>
            </div>

            <!-- Pumps -->
            <div class="pump-grid" id="pumpGrid"></div>
        </div>

        <!-- History Page -->
        <div id="page-history" class="hidden">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="material-symbols-rounded">history</span>
                    History Log
                </h1>
            </div>
            
            <div class="history-section">
                <!-- FILTERS & CONTROLS -->
                <div class="history-controls">
                    <!-- Row 1: Search & Quick Date Filters -->
                    <div class="control-row">
                        <!-- Search -->
                        <div class="search-box">
                            <span class="material-symbols-rounded">search</span>
                            <input 
                                type="text" 
                                id="searchInput"
                                placeholder="Search by time or status..." 
                                oninput="handleSearchInput(this.value)"
                            >
                        </div>
                        
                        <!-- Quick Date Filters -->
                        <div class="quick-filters">
                            <button class="quick-filter-btn active" onclick="applyQuickFilter('all')">All</button>
                            <button class="quick-filter-btn" onclick="applyQuickFilter('today')">Today</button>
                            <button class="quick-filter-btn" onclick="applyQuickFilter('yesterday')">Yesterday</button>
                            <button class="quick-filter-btn" onclick="applyQuickFilter('week')">Last 7 Days</button>
                            <button class="quick-filter-btn" onclick="applyQuickFilter('month')">Last 30 Days</button>
                        </div>
                    </div>
                    
                    <!-- Row 2: Date Range & Status Filters -->
                    <div class="control-row">
                        <!-- Date Range Picker -->
                        <div class="date-range-picker">
                            <div class="date-input-group">
                                <span class="material-symbols-rounded">calendar_today</span>
                                <input 
                                    type="date" 
                                    id="dateFrom"
                                    onchange="filterByDateRange()"
                                >
                                <span class="date-separator">to</span>
                                <input 
                                    type="date" 
                                    id="dateTo"
                                    onchange="filterByDateRange()"
                                >
                                <button class="btn-clear-date" onclick="clearDateFilter()">
                                    <span class="material-symbols-rounded">close</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Status Filters -->
                        <div class="filter-group">
                            <select onchange="filterByStatus('pump1', this.value)" class="filter-select">
                                <option value="all">All P1 Status</option>
                                <option value="0">Unknown</option>
                                <option value="1">Running</option>
                                <option value="2">Stopped</option>
                                <option value="3">Error</option>
                            </select>
                            
                            <select onchange="filterByStatus('pump2', this.value)" class="filter-select">
                                <option value="all">All P2 Status</option>
                                <option value="0">Unknown</option>
                                <option value="1">Running</option>
                                <option value="2">Stopped</option>
                                <option value="3">Error</option>
                            </select>
                        </div>
                        
                        <!-- Actions -->
                        <div class="action-group">
                            <button class="btn-action btn-export" onclick="exportToCSV()">
                                <span class="material-symbols-rounded">download</span>
                                <span class="btn-text">Export CSV</span>
                            </button>
                            
                            <button class="btn-action btn-refresh" onclick="refreshHistory()">
                                <span class="material-symbols-rounded">refresh</span>
                                <span class="btn-text">Refresh</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Stats Summary -->
                <div class="history-stats" id="historyStats">
                    <div class="stat-card">
                        <span class="material-symbols-rounded">database</span>
                        <div>
                            <div class="stat-label">Total Records</div>
                            <div class="stat-value" id="totalRecords">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="material-symbols-rounded">filter_alt</span>
                        <div>
                            <div class="stat-label">Filtered</div>
                            <div class="stat-value" id="filteredRecords">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="material-symbols-rounded">schedule</span>
                        <div>
                            <div class="stat-label">Date Range</div>
                            <div class="stat-value" id="dateRange">--</div>
                        </div>
                    </div>
                </div>
                
                <!-- TABLE -->
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th data-column="timestamp" onclick="sortTable('timestamp')" class="sortable">
                                    <span class="material-symbols-rounded icon">schedule</span>
                                    <span>Time</span>
                                    <span class="sort-indicator"></span>
                                </th>
                                <th data-column="pump1" onclick="sortTable('pump1')" class="sortable">
                                    <span class="material-symbols-rounded icon">power</span>
                                    <span>P1 CMD</span>
                                    <span class="sort-indicator"></span>
                                </th>
                                <th data-column="pump1_status" onclick="sortTable('pump1_status')" class="sortable">
                                    <span class="material-symbols-rounded icon">electric_bolt</span>
                                    <span>P1 Status</span>
                                    <span class="sort-indicator"></span>
                                </th>
                                <th data-column="pump2" onclick="sortTable('pump2')" class="sortable">
                                    <span class="material-symbols-rounded icon">power</span>
                                    <span>P2 CMD</span>
                                    <span class="sort-indicator"></span>
                                </th>
                                <th data-column="pump2_status" onclick="sortTable('pump2_status')" class="sortable">
                                    <span class="material-symbols-rounded icon">electric_bolt</span>
                                    <span>P2 Status</span>
                                    <span class="sort-indicator"></span>
                                </th>
                                <th data-column="busy" onclick="sortTable('busy')" class="sortable">
                                    <span class="material-symbols-rounded icon">sync</span>
                                    <span>Inverter</span>
                                    <span class="sort-indicator"></span>
                                </th>
                                <th data-column="alarm" onclick="sortTable('alarm')" class="sortable">
                                    <span class="material-symbols-rounded icon">warning</span>
                                    <span>Alarm</span>
                                    <span class="sort-indicator"></span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="historyBody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- PAGINATION -->
                <div class="pagination-container" id="paginationContainer">
                    <!-- Pagination will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="page-settings" class="hidden">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="material-symbols-rounded">settings</span>
                    Settings
                </h1>
            </div>
            <div class="gateway-card">
                <h3><span class="material-symbols-rounded">dns</span>API Configuration</h3>
                <div class="info-row">
                    <span class="info-label"><span class="material-symbols-rounded">link</span>Server:</span>
                    <span>http://localhost:8080</span>
                </div>
                <div class="info-row">
                    <span class="info-label"><span class="material-symbols-rounded">refresh</span>Auto-refresh:</span>
                    <span>2 seconds</span>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>